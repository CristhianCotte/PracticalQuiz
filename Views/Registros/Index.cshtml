
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container" style="margin-top:20px">
    <div class="table-wrapper">
        <div class="table-title">
            <div class="row">
                <div class="col-12">
                    <h2>Registros</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="input-group">
                        <span class="input-group-btn">
                            <button class="btn btn-default"  style="color:darkgray;" type="button"><i class="glyphicon glyphicon-search"></i> <!-- Ícono de búsqueda --></button>
                        </span>
                        <input type="text" class="form-control" placeholder="Search for...">
                    </div><!-- /input-group -->
                </div><!-- /.col-lg-6 -->
                <div class="col-sm-6">
                    <a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Añadir nuevo registro</span></a>
                </div>
                @*<div class="col-lg-6">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search for...">
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button">
                                <i class="glyphicon glyphicon-search"></i> <!-- Ícono de búsqueda -->
                            </button>
                        </span>
                    </div><!-- /input-group -->
                </div><!-- /.col-lg-6 -->*@
            </div>
        </div>
        <table id="tablaUsuarios" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Cedula</th>
                    <th>Nombre</th>
                    <th>Genero</th>
                    <th>Fecha de naciemiento</th>
                    <th>Estado Civil</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
               
            </tbody>
        </table>
        <div class="clearfix">
            <div class="hint-text">Showing <b>5</b> out of <b>25</b> entries</div>
            <ul class="pagination">
                <li class="page-item disabled"><a href="#">Previous</a></li>
                <li class="page-item"><a href="#" class="page-link">1</a></li>
                <li class="page-item"><a href="#" class="page-link">2</a></li>
                <li class="page-item active"><a href="#" class="page-link">3</a></li>
                <li class="page-item"><a href="#" class="page-link">4</a></li>
                <li class="page-item"><a href="#" class="page-link">5</a></li>
                <li class="page-item"><a href="#" class="page-link">Next</a></li>
            </ul>
        </div>
    </div>

</div>
	<!-- Create Modal HTML -->
<div id="addEmployeeModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="addClientForm">
                <div class="modal-header">
                    <h4 class="modal-title">Añadir registro</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Cedula</label>
                        <input type="text" name="cedula" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" name="nombre" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="Genero">Genero</label>
                        <select id="Genero" name="genero" class="form-control" required>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                            <option value="Prefiero no responder">Prefiero no responder</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="id_estado_civil">Estado Civil</label>
                        <select id="id_estado_civil" name="oEstadoCivil.id_estado_civil" class="form-control" data-toggle="tooltip" data-placement="bottom" title="Selecciona una opción" required>
                            <option value="">Cargando...</option> <!-- Se llenará con AJAX -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha de nacimiento</label>
                        <input type="date" name="fecha_nac" class="form-control" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-success" value="Add">
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Edit Modal HTML -->
<div id="editEmployeeModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <form>
                <div class="modal-header">
                    <h4 class="modal-title">Editar Registro</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Cedula</label>
                        <input type="text" class="form-control" required>
                        <a href="#" data-toggle="tooltip" title="first tooltip">Hover over me</a>

                    </div>
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" class="form-control" required>
                        <a href="#" data-toggle="tooltip" title="first tooltip">Hover over me</a>

                    </div>
                    <div class="form-group">
                        <label for="Genero">Genero</label>
                        <select id="Genero" name="Genero" class="form-control" required>
                            <option value="1">Masculino</option>
                            <option value="2">Femenino</option>
                            <option value="3">Prefiero no responder</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha de nacimiento</label>
                        <input type="date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="EstadoCivilId">Estado Civil</label>
                        <select id="EstadoCivilId" name="EstadoCivilId" class="form-control" required>
                            <option value="1">Soltero</option>
                            <option value="2">Casado</option>
                            <option value="3">Divorciado</option>
                            <option value="4">Viudo</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                    <input type="submit" class="btn btn-info" value="Save">
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#addClientForm').on('submit', function (e) {
            e.preventDefault(); // Prevenir el envío normal del formulario
            console.log($(this).serialize()); // Para verificar los datos enviados

            $.ajax({
                url: '/Registros/Add', // Cambia esto al nombre de tu controlador
                type: "POST",
                data: $(this).serialize(), // Serializa los datos del formulario
                success: function (response) {
                    if (response.success) {
                        alert(response.message);
                        // Aquí puedes agregar código para actualizar la lista de clientes
                        $('#addEmployeeModal').modal('hide'); // Cerrar el modal
                    } else {
                        alert('Error: ' + response.message);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Ha ocurrido un error: ' + error);
                }
            });
        });
        $.ajax({
            url: '/Registros/ListarRegistros', // Ruta del método en el controlador
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                let tbody = $("#tablaUsuarios tbody"); // Seleccionar el cuerpo de la tabla
                tbody.empty(); // Limpiar contenido previo

                $.each(data, function (index, item) {
                    let fechaFormateada = new Date(parseInt(item.fecha_nac.substr(6))).toISOString().split('T')[0];
                    let row = `<tr>
                        <td>${item.id_clie}</td>
                        <td>${item.cedula}</td>
                        <td>${item.nombre}</td>
                        <td>${item.genero}</td>
                        <td>${fechaFormateada}</td>
                        <td>${item.oEstadoCivil.nombre}</td>
                        <td>
                            <a href="#editEmployeeModal" class="edit" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
                            <a href="#deleteEmployeeModal" class="delete" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i></a>
                        </td>
                    </tr>`;
                    tbody.append(row);
                });
            },
            error: function () {
                alert("Error al obtener la lista de registros.");
            }
        });
    });
     $(document).ready(function () {
         // Llamar al método ListaUsuarios cuando la página cargue
        $.ajax({
            url: '/Registros/ListarEstadoCivil', // Ruta del método en el controlador
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                // Limpiar la tabla antes de agregar datos
                //$("#tablaUsuarios tbody").empty();
                let selectEstadoCivil = $("#id_estado_civil"); // Seleccionar el elemento <select>
                selectEstadoCivil.empty(); // Limpiar opciones existentes

                // Agregar opción por defecto
                selectEstadoCivil.append('<option value="">Seleccione una opción</option>');

                // Recorrer la lista de datos y agregar opciones al <select>
                $.each(data, function (index, item) {
                    selectEstadoCivil.append('<option value="' + item.id_estado_civil + '">' + item.nombre + '</option>');
                });
            },
            error: function () {
                alert("Error al obtener la lista de usuarios.");
            }
        });
    });
    $(document).ready(function () {

        $('[data-toggle="tooltip"]').tooltip(); // Activa los tooltips

        // Select/Deselect checkboxes
        var checkbox = $('table tbody input[type="checkbox"]');
        $("#selectAll").click(function () {
            if (this.checked) {
                checkbox.each(function () {
                    this.checked = true;
                });
            } else {
                checkbox.each(function () {
                    this.checked = false;
                });
            }
        });
        checkbox.click(function () {
            if (!this.checked) {
                $("#selectAll").prop("checked", false);
            }
        });
    });
</script>